import fs from 'fs'
import path from 'path'

// åˆ›å»ºä¸€ä¸ªç®€å•ä½†æœ‰æ•ˆçš„ PNG å›¾æ ‡ (16x16 è“è‰²æ–¹å—)
function createIcon(size) {
  // è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è“è‰²æ–¹å— PNG çš„å­—èŠ‚æ•°æ®
  const pngHeader = [
    0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A, // PNG ç­¾å
    0x00, 0x00, 0x00, 0x0D, 0x49, 0x48, 0x44, 0x52, // IHDR chunk
    0x00, 0x00, 0x00, size, 0x00, 0x00, 0x00, size,  // å®½åº¦å’Œé«˜åº¦
    0x08, 0x02, 0x00, 0x00, 0x00                     // ä½æ·±åº¦ã€é¢œè‰²ç±»å‹ç­‰
  ]
  
  // ç®€å•çš„è“è‰²åƒç´ æ•°æ®
  const bluePixel = [0x19, 0x76, 0xD2] // #1976d2 è“è‰²
  const pixelData = []
  
  for (let y = 0; y < size; y++) {
    pixelData.push(0x00) // è¡Œè¿‡æ»¤å™¨ç±»å‹
    for (let x = 0; x < size; x++) {
      pixelData.push(...bluePixel)
    }
  }
  
  // åˆ›å»ºæœ€å°æœ‰æ•ˆ PNGï¼ˆå®é™…ä¸Šè¿™æ˜¯ç®€åŒ–ç‰ˆæœ¬ï¼‰
  const minimalPNG = [
    0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A,
    0x00, 0x00, 0x00, 0x0D, 0x49, 0x48, 0x44, 0x52,
    0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x10,
    0x08, 0x02, 0x00, 0x00, 0x00, 0x90, 0x91, 0x68,
    0x36, 0x00, 0x00, 0x00, 0x3C, 0x49, 0x44, 0x41,
    0x54, 0x28, 0x15, 0x63, 0x64, 0x60, 0xF8, 0x0F,
    0xC3, 0x50, 0x30, 0x0A, 0x46, 0xC1, 0x28, 0x18,
    0x05, 0xA3, 0x60, 0x14, 0x8C, 0x82, 0x51, 0x30,
    0x0A, 0x46, 0xC1, 0x28, 0x18, 0x05, 0xA3, 0x60,
    0x14, 0x8C, 0x82, 0x51, 0x30, 0x0A, 0x46, 0xC1,
    0x28, 0x18, 0x05, 0xA3, 0x60, 0x14, 0x8C, 0x82,
    0x51, 0x30, 0x0A, 0x46, 0xC1, 0x28, 0x18, 0x05,
    0x00, 0x00, 0x04, 0x10, 0x00, 0x01, 0x27, 0xDF,
    0xBE, 0x07, 0x00, 0x00, 0x00, 0x00, 0x49, 0x45,
    0x4E, 0x44, 0xAE, 0x42, 0x60, 0x82
  ]
  
  return Buffer.from(minimalPNG)
}

const iconsDir = './dist/icons'
const sizes = [16, 48, 128]

// ç¡®ä¿ç›®å½•å­˜åœ¨
if (!fs.existsSync(iconsDir)) {
  fs.mkdirSync(iconsDir, { recursive: true })
}

// ä¸ºæ¯ä¸ªå°ºå¯¸åˆ›å»º PNG æ–‡ä»¶
sizes.forEach(size => {
  const iconBuffer = createIcon(size)
  const iconPath = path.join(iconsDir, `icon${size}.png`)
  fs.writeFileSync(iconPath, iconBuffer)
  console.log(`âœ… åˆ›å»ºå›¾æ ‡: ${iconPath} (${iconBuffer.length} bytes)`)
})

console.log('ğŸ‰ å›¾æ ‡åˆ›å»ºå®Œæˆï¼ç°åœ¨å¯ä»¥åœ¨ Chrome ä¸­åŠ è½½æ’ä»¶äº†ã€‚')
console.log('ğŸ’¡ æç¤º: å¦‚æœéœ€è¦è‡ªå®šä¹‰å›¾æ ‡ï¼Œè¯·åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º icons/ æ–‡ä»¶å¤¹å¹¶æ”¾å…¥ä½ çš„å›¾æ ‡æ–‡ä»¶ã€‚') 